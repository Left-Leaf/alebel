# 操作说明

## 基础操作

| 操作      | 方式   | 说明                      |
|:--------|------|-------------------------|
| 选中格子/单位 | 点击   | 短按后松开，选中该格子或单位          |
| 查看方格信息  | 长按   | 在同一格子内按住 ≥ 0.4 秒，显示信息面板 |
| 关闭信息面板  | 松开   | 松开鼠标即关闭                 |
| 平移地图    | 拖拽   | 按住并移动鼠标                 |
| 缩放地图    | 滚轮   | 向上放大，向下缩小               |
| 悬停预览    | 移动鼠标 | 高亮当前格子（白色边框）            |
| 取消操作    | ESC  | 取消当前选择和范围显示             |

---

## 交互判定

| 条件                    | 效果             |
|-----------------------|----------------|
| 按住 ≥ 0.4s 且鼠标保持在同一格子内 | **长按**：显示方格信息  |
| 移动距离 ≥ 5px            | **拖拽**：平移地图    |
| 移动距离 < 5px 且未触发长按后松开  | **点击**：选中格子/单位 |

**注意**：

- 长按需要鼠标一直保持在按下时的格子内才会触发
- 如果按下后移出该格子，则不会触发长按
- 拖拽和长按互不冲突，可以同时进行

---

## 单位选择与操作

### 选中可操控单位

当点击一个**可操控的单位**（己方单位且未行动完毕）时：

1. 显示单位信息面板（右上角）
2. 显示**移动范围**（蓝色半透明覆盖层）
3. 显示**攻击范围**（红色半透明覆盖层）

(有关移动范围，攻击范围定义见[README.md](../unit/README.md))

### 选中不可操控单位

当点击一个**不可操控的单位**（敌方/友军/已行动单位）时：

- 仅显示单位信息面板
- 不显示任何范围高亮

### 选中单位后的交互流程

假设已选中位于方格 A 的可操控单位，再次点击方格 B 时：

#### 情况 1：点击同一方格（A = B）

- **效果**：取消选中，清除所有高亮和面板

#### 情况 2：点击不同方格（A ≠ B）

**步骤 1：检查方格 B 是否有单位**

##### 2.1 方格 B 有单位

- **检查是否在交互范围内**
  - **在交互范围内**
    - 检查是否可以交互
      - ✅ **可以交互**：执行交互
      - ❌ **不可以交互**：改为选中方格 B 的单位
  - **不在攻击范围内**
    - 改为选中方格 B 的单位

##### 2.2 方格 B 无单位

- **检查是否在移动范围内**
  - **在移动范围内**
    - 检查是否可以移动（地形可通行、无障碍物）
      - ✅ **可以移动**：
                1. 进入**移动投影模式**
                2. 将单位 A 半透明投影到方格 B
                3. 显示从方格 B 出发的攻击范围（红色）
                4. 再次点击方格 B：确认移动
                5. 点击其他位置：取消投影，返回选中状态
      - ❌ **不可以移动**：取消选中单位 A，改为选中方格 B
  - **不在移动范围内**
    - 取消选中单位 A
